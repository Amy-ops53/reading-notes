# 제 2장. 느려진 서비스, 어디부터 봐야 할까

## 1. 서버 성능과 관련 있는 것

### 응답 시간
- 사용자의 요청을 처리하는 데 걸리는 시간.
- **DB 연동**과 **외부 API 연동**이 로직 수행 시간보다 비중이 크므로 이 부분에 집중해 최적화한다.

### 처리량
- 단위 시간당 시스템이 처리하는 작업량.
  - **TPS**: 초당 트랜잭션 수  
  - **RPS**: 초당 요청 수

### 성능 문제의 원인을 찾았다면
- **수직 확장 (Vertical Scaling)**  
  CPU, 메모리, 디스크 등의 자원을 늘려 급한 불을 끄는 방법.  
  동시 요청이 많을 때 메모리 증설만으로도 TPS를 늘릴 수 있음.
- **수평 확장 (Horizontal Scaling)**  
  서버를 여러 대로 늘려 처리량 자체를 증가시키는 방법.

### DB 커넥션 풀을 사용하는 이유
- 서버와 DB는 네트워크를 통해 연결되며, **연결·종료 시간이 쿼리 실행 시간보다 더 오래 걸릴 수 있음**.  
  → 커넥션 풀을 사용해 연결을 재활용하면 성능이 크게 향상된다.

---

## 2. 성능을 좌우하는 DB 설계와 쿼리

### DB 풀 스캔 발생 조건
- **풀 스캔**: 테이블의 모든 데이터를 순차적으로 읽는 것.  
- WHERE 절의 조건과 일치하는 **인덱스가 없을 때** 발생.

### 응답 데이터 압축
- 네트워크 속도가 느리면 응답이 지연될 수 있음.  
- 서버에서 전송하는 데이터의 크기를 줄이면 응답 시간을 크게 줄일 수 있음.  
- 예) 텍스트 데이터를 **gzip**으로 압축 시 70% 이상 크기 절감.

### 클라이언트 캐시
- 클라이언트가 응답 데이터를 일정 시간 저장하도록 설정 가능.  
- 서버는 전송 트래픽이 줄어 네트워크 비용을 절감.  
- 예) `Cache-Control: max-age=60`

### 타임아웃
- 신규 연동 서비스라면 타임아웃을 **적정 값으로 설정 후 추이를 보며 조정**.
  - 연결 타임아웃: **3~5초**
  - 읽기 타임아웃: **5~30초**

---

## 3. 비동기 연동, 언제 어떻게 써야 할까

### 비동기 연동 고려
- 외부 서비스 연동이 전체 응답 속도를 늦출 수 있다면,  
  **다음 작업에 반드시 결과가 필요하지 않을 경우** 비동기 방식으로 전환을 검토한다.

### 메시징 시스템
- 서로 다른 시스템 간 비동기 연동에 주로 사용.
  - **생산자**: 메시지를 생성해 메시징 시스템에 보냄
  - **소비자**: 메시징 시스템에서 메시지를 받아 처리

### 배치 전송
- 데이터를 비동기로 연동하는 가장 전통적인 방식.
